import './polyfills.server.mjs';
import{Cb as g,Lb as f,M as a,U as p,vb as m,w as i,z as r}from"./chunk-R7BEQ5AU.mjs";import{h as n}from"./chunk-S6KH3LOX.mjs";var s=class o{isLogin=a(!1);updateLoginStatus(t){this.isLogin.set(t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};var c=class o{constructor(t){this.platformId=t}getToken(){return n(this,null,function*(){let t=null;if(m(this.platformId)&&(t=localStorage.getItem("jwt")),!t)throw new Error("No JWT token found. Login again.");return t})}static \u0275fac=function(e){return new(e||o)(r(p))};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};var h=class o{constructor(t,e,l,b){this.router=t;this.http=e;this.commonService=l;this.headerService=b}tokenKey="jwt";baseUrl="http://localhost:8080/auth";_isLogin=a(!1);isLogin=this._isLogin.asReadonly();updateLoginStatus(t){this._isLogin.set(t)}login(t,e){if(t&&e)return this._isLogin.set(!0),console.log("Login called with:",t,e,this.isLogin()),this.http.post(`${this.baseUrl}/login`,{username:t,password:e},{responseType:"text"});throw new Error("Invalid email or password")}register(t,e,l){if(e&&l)return this.http.post(`${this.baseUrl}/register`,{username:t,email:e,password:l},{responseType:"text"});throw new Error("Invalid email or password")}logout(){return n(this,null,function*(){let t=yield this.commonService.getToken();console.log("Token in logout:",t),yield fetch(`${this.baseUrl}/logout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({token:t})}).then(e=>{console.log("Logout response:",e),e.ok&&(this._isLogin.set(!1),localStorage.removeItem(this.tokenKey),this.headerService.updateLoginStatus(!1),this.router.navigateByUrl("/",{replaceUrl:!0}))}).catch(e=>(console.error("Logout error:",e),null))})}isAuthenticated(){return!!localStorage.getItem(this.tokenKey)}static \u0275fac=function(e){return new(e||o)(r(f),r(g),r(c),r(s))};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a,s as b,h as c};
